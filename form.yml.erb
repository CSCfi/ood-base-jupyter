# Batch Connect app configuration file
#
# @note Used to define the submitted cluster, title, description, and
#   hard-coded/user-defined attributes that make up this Batch Connect app.
---

# **MUST** set cluster id here that matches cluster configuration file located
# under /etc/ood/config/clusters.d/*.yml
# @example Use the Owens cluster at Ohio Supercomputer Center
#     cluster: "owens"
cluster: "puhti"

# Define attribute values that aren't meant to be modified by the user within
# the Dashboard form
attributes:
  # Set the corresponding modules that need to be loaded for Jupyter to run
  #
  # @note It is called within the batch job as `module load <modules>` if
  #   defined
  # @example Do not load any modules
  #     modules: ""
  # @example Using default python module
  #     modules: "python"
  # @example Using specific python module
  #     modules: "python/3.5"
  # @example Using combination of modules
  #     modules: "python/3.5 cuda/8.0.44"
  #modules: "python-env/2019.3"
  #bc_queue: "test" 

  # Any extra command line arguments to feed to the `jupyter notebook ...`
  # command that launches the Jupyter notebook within the batch job

  csc_slurm_partition:
    value: "interactive"
    select:
      - "interactive"
      - "small"
      - "gpu"
      - "gputest"
      - "test"
      - "fmi"
      - "fmitest"
    help: |
      Selecting a gpu partition will reserve 1 GPU (V100)
  csc_slurm_reservation:
    partitions:
      - "interactive"
      - "small"
      - "gpu"
      - "gputest"
      - "test"
      - "fmi"
      - "fmitest"
  csc_slurm_limits:
    data:
      limits:
        gpu:
          time: "8:00:00"
  python_module:
      label: Python
      widget: select
      options:
          - ["Cray-python"]
          - ["System-python"]
          - ["Custom"]

      wrapper:
        class: "basic"
  custom_module:
    widget: text_field
    label: "Path to python"
    value : ""
    wrapper:
      class: "basic custom_module"
    help: |
        Specify the full path to the python interpreter to use
  jp_type:
      widget: select
      label: "Jupyter type"
      options:
        - ["Notebook","notebook"]
        - ["Lab","lab", data-option-for-python-module-python-data: false]
      value: "notebook"
  csc_path:
    submit: notebook_dir
    label: "Working directory"
    paths:
      - "HOME"
      - "SCRATCH"
      - "PROJAPPL"
      - "/"
  advanced:
    label: "Show advanced settings"
    widget: check_box
    value: "0"
  venv:
    widget: text_field
    label: "Virtual environment path"
    value : ""
    wrapper:
      class: "venv"
    help: |
      Path to a virtual environment under `/scratch/${your_project}` or `/projappl/${your_project}`. A new virtual environment will be created using `python -m venv <path>` if it does not exist. Leave empty to ignore.
  system_site:
      label: "Enable system installed packages on venv creation"
      widget: check_box
      value: "1"
  user_packages:
      label: "Enable packages under ~/.local/lib on venv start"
      widget: check_box
      value: "0"
  env_script:
      label: "Custom init"
      widget: select
      wrapper:
        class: "advanced"
      options:
          - ["None", "None" , {data-hide-custom-start: true, data-hide-custom-script: true} 
            ]
          - ["Text","Text",{  data-hide-custom-script: true}]
          - ["File","File",{data-hide-custom-start: true }]
  custom_start:
      label: "Script to start"
      widget: "text_area"
      value: ""
      wrapper: 
        class: "advanced"
  custom_script:
      label: "Path to script"
      widget: "text_field"
      value: ""
      wrapper:
         class: "advanced"
  csc_reset_cache:
    app: "sys/ood-base-jupyter"
  csc_extra_desc:
    desc: |
      <a href="https://docs.csc.fi/computing/webinterface/jupyter/" target="_blank">Documentation</a>

form:
  - csc_extra_desc
  - csc_slurm_reservation
  - csc_slurm_project
  - csc_slurm_partition
  - csc_header_resources
  - csc_cores
  - csc_memory
  - csc_nvme
  - csc_time
  - csc_header_settings
  - python_module
  - custom_module
  - jp_type
  - csc_path
  - venv
  - system_site
  - user_packages
  - advanced
  - env_script
  - custom_start
  - custom_script
  - csc_reset_cache
  - csc_slurm_limits
