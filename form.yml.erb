# Batch Connect app configuration file
#
# @note Used to define the submitted cluster, title, description, and
#   hard-coded/user-defined attributes that make up this Batch Connect app.
---

# **MUST** set cluster id here that matches cluster configuration file located
# under /etc/ood/config/clusters.d/*.yml
# @example Use the Owens cluster at Ohio Supercomputer Center
#     cluster: "owens"

# Define attribute values that aren't meant to be modified by the user within
# the Dashboard form
attributes:
  # Set the corresponding modules that need to be loaded for Jupyter to run
  #
  # @note It is called within the batch job as `module load <modules>` if
  #   defined
  # @example Do not load any modules
  #     modules: ""
  # @example Using default python module
  #     modules: "python"
  # @example Using specific python module
  #     modules: "python/3.5"
  # @example Using combination of modules
  #     modules: "python/3.5 cuda/8.0.44"
  #modules: "python-env/2019.3"
  #bc_queue: "test" 

  # Any extra command line arguments to feed to the `jupyter notebook ...`
  # command that launches the Jupyter notebook within the batch job

  csc_slurm_partition:
    value: "interactive"
    select:
      - "interactive"
      - "small"
      - "small-g"
      - "largemem"
      - "lumid"
      - "dev-g"
      - "debug"
      - "q_fiqci"
  csc_slurm_reservation:
    partitions:
      - "interactive"
      - "small"
      - "small-g"
      - "largemem"
      - "lumid"
      - "dev-g"
      - "debug"
  python_module:
      label: Python
      widget: select
      options:
          - ["Cray-python (3.9.13)", "cray-python/3.9.13.1", data-hide-custom-python-path: true]
          - ["Custom"]
      wrapper:
        class: "basic"
  custom_python_path:
    widget: text_field
    label: "Path to python"
    value : ""
    wrapper:
      class: "basic custom_module"
    help: |
        Specify the full path to the python interpreter to use
  jp_type:
      widget: select
      label: "Jupyter type"
      options:
        - ["Notebook","notebook"]
        - ["Lab","lab"]
      value: "notebook"
  csc_path:
    submit: notebook_dir
    label: "Working directory"
    paths:
      - "HOME"
      - "SCRATCH"
      - "PROJAPPL"
      - "/"
  advanced:
    label: "Show advanced settings"
    widget: check_box
    value: "0"
    hidden: true
    skip_label: true
  venv:
    widget: text_field
    label: "Virtual environment path"
    value : ""
    wrapper:
      class: "venv basic"
    help: |
      Path to a virtual environment under `/scratch/${your_project}` or `/projappl/${your_project}`. A new virtual environment will be created using `python -m venv <path>` if it does not exist. Leave empty to ignore.
  system_site:
      label: "Enable system installed packages on venv creation"
      widget: check_box
      value: "1"
      wrapper_class: "basic"
  user_packages:
      label: "Enable packages under ~/.local/lib on venv start"
      widget: check_box
      value: "0"
      wrapper_class: "basic"
  env_script:
      label: "Custom init"
      widget: select
      wrapper:
        class: "advanced"
      options:
          - ["Text","Text",{  data-hide-custom-script: true}]
          - ["File","File",{ data-hide-custom-start: true }]
  custom_start:
      label: "Script to start"
      widget: "text_area"
      value: ""
      wrapper:
        class: "advanced"
      help: |
        The bash script provided in the text box will be run before starting Jupyter. Ensure that the script sets up the environment so that `python` is in `PATH` and Jupyter is installed.
  custom_script:
      label: "Path to script"
      widget: "text_field"
      value: ""
      wrapper:
         class: "advanced"
      help: |
        The script on the path provided will be sourced by bash before starting Jupyter. Ensure that the script sets up the environment so that `python` is in `PATH` and Jupyter is installed.
  csc_reset_cache:
    app: "sys/ood-base-jupyter"
  csc_extra_desc:
    desc: |
      <a href="https://docs.csc.fi/computing/webinterface/jupyter/" target="_blank">Documentation</a>

form:
  - csc_extra_desc
  - csc_slurm_reservation
  - csc_slurm_project
  - csc_slurm_partition
  - csc_header_resources
  - csc_cores
  - csc_memory
  - csc_nvme
  - csc_time
  - csc_header_settings
  - jp_type
  - csc_path
  - advanced
  - python_module
  - custom_python_path
  - venv
  - system_site
  - user_packages
  - env_script
  - custom_start
  - custom_script
  - csc_reset_cache
  - csc_slurm_limits
